<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="../assets/layui/css/layui.css" media="all">
    <script src="../assets/layui/layui.js" charset="utf-8"></script>
    <script src="../assets/jquery-3.2.1.js"></script>
    <style>
        #upload p{
            float: left;
        }
    </style>
</head>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo">后台管理系统</div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="layui-nav layui-layout-left" style="margin-top: 20px;">
                <span class="layui-breadcrumb">
                    <a href="../index.html">首页</a>
                    <a href="javascript:;">商品管理</a>
                    <a href="javascript:;">添加商品</a>
                </span>
            </ul>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;" id="username">
                      <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                      
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="">基本资料</a></dd>
                        <dd><a href="">安全设置</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item" id="output"><a href="">退了</a></li>
            </ul>
        </div>
        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item layui-nav-itemed">
                        <a class="" href="javascript:;">商品管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="goodList.html">商品列表</a></dd>
                            <dd><a href="goodsCategory.html">商品分类</a></dd>
                            <dd><a href="AddGoods.html">添加商品</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">用户管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="userCategory.html">用户列表</a></dd>
                            <dd><a href="addUser.html">添加用户</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">订单管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="order.html">订单列表</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div style="padding: 15px;">
                <!-- <ins class="adsbygoogle" style="display:inline-block;width:970px;height:90px" data-ad-client="ca-pub-6111334333458862" data-ad-slot="3820120620"></ins> -->
                <form class="layui-form" action="" lay-filter="example">
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="headline" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input caption">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品副标题</label>
                        <div class="layui-input-inline">
                            <input type="text" name="subheading" lay-verify="title" autocomplete="off" placeholder="请输入" class="layui-input  caption">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品价格</label>
                        <div class="layui-input-inline">
                            <input type="text" name="subheading" lay-verify="title" autocomplete="off" class="layui-input priceOld">
                        </div>
                        <label class="layui-form-label">销售价格</label>
                        <div class="layui-input-inline">
                            <input type="text" name="subheading" lay-verify="title" autocomplete="off" class="layui-input priceNow">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品分类</label>
                        <div class="layui-input-inline" id="category">
                            <select name="modules" lay-verify="required" class="category">
                                <!-- <option value="手机">手机</option> -->
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品图片</label>
                        <div id="upload">
                            <p><input type="file" name="goodspic" id="goodspic"></p>
                            <p class="layui-inline" id="upPic" style="display:none;"></p>
                            <p><button class="btnsend">上传</button></p>
                            <p><img src="" width="120px" height="120px" id="pvwImg" alt="" /></p>
                            
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">库存</label>
                        <div class="layui-input-inline">
                            <input type="text" name="subheading" lay-verify="title" autocomplete="off" class="layui-input stock">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">复选框</label>
                        <div class="layui-input-block">
                            <input type="checkbox" name="like[write]" title="热卖">
                            <input type="checkbox" name="like[read]" title="推荐">
                            <input type="checkbox" name="like[daze]" title="促销">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">上架</label>
                        <div class="layui-input-block" id="putaway">
                            <input type="checkbox" name="close" lay-skin="switch" lay-text="ON|OFF" checked>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">商品描述</label>
                        <div class="layui-input-block">
                            <textarea placeholder="请输入内容" class="layui-textarea" name="desc"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <a href="javascript:;" class="layui-btn ist_btn">确认</a>
                        </div>
                    </div>
                </form>
                <script>
                function callback() {
                    layui.use(['form', 'layedit', 'laydate'], function() {
                        var form = layui.form,
                            layer = layui.layer,
                            layedit = layui.layedit,
                            laydate = layui.laydate;


                        //自定义验证规则
                        form.verify({
                            title: function(value) {
                                if (value.length < 2) {
                                    return '标题至少得5个字符啊';
                                }
                            },
                            pass: [/(.+){6,12}$/, '密码必须6到12位'],
                            content: function(value) {
                                layedit.sync(editIndex);
                            }
                        });

                        //监听指定开关
                        form.on('switch(switchTest)', function(data) {
                            layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
                                offset: '6px'
                            });
                            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
                        });

                        //监听提交
                        // form.on('submit(demo1)', function(data) {
                        //     layer.alert(JSON.stringify(data.field), {
                        //         title: '最终的提交信息'
                        //     })
                        //     return false;
                        // });

                        //表单初始赋值
                        form.val('example', {
                            "username": "贤心" // "name": "value"
                                ,
                            "password": "123456",
                            "interest": 1,
                            "like[write]": true //复选框选中状态
                                ,
                            "close": true //开关状态
                                ,
                            "sex": "女",
                            "desc": ""
                        })
                    });
                };
                </script>
                <script>
                //上传图片
                let goodspic = document.querySelector('#goodspic');
                let btnsend = document.querySelector('.btnsend');
                let upPic = document.querySelector('#upPic');
                let pvwImg = document.querySelector('#pvwImg');
                btnsend.onclick = (e) => {
                    // console.log('file:', goodspic.files);
                    e.preventDefault();
                    let formData = new FormData();
                    formData.append('goodspic', goodspic.files[0]);
                    let xhr = new XMLHttpRequest();
                    xhr.onload = () => {
                        // console.log(xhr.responseText);
                        let data = JSON.parse(xhr.responseText);
                        // console.log(data.data[1])
                        upPic.innerHTML = data.data[1];//这里换成图片路径
                        pvwImg.setAttribute("src",data.data[1]);
                    }
                    xhr.open('post', '/html/upload', true);
                    xhr.send(formData)
                }


                //查找所有分类
                $.ajax({
                    type: "get", //请求方式
                    url: "/html/goodsCategory/", //接口路径
                    async: true, //异步
                    data: {},
                    success: category
                })
                //渲染分类数据
                function category(str) {
                    var data = str.data;
                    // console.log(data);
                    var res = '';
                    for (var i = 0; i < data.length; i++) {
                        res += `<option value="${data[i].classify}">${data[i].classify}</option>`
                    }
                    res = '<option>请选择</option>' + res;
                    $('.category').html(res);
                    callback();
                    // console.log(res);
                }
                //插入数据
                $('.ist_btn').click(() => {
                    var classify = $('#category').find('.layui-this').html();
                    var state = $('#putaway').find('em').html();
                    if (state == 'ON') {
                        state = '上架'
                    } else {
                        state = '下架'
                    }
                    $.ajax({
                        type: "put", //请求方式
                        url: "/html/goods/" + '0807', //接口路径
                        async: true, //异步
                        data: {
                            goods: $('.caption').val(),
                            priceOld: $('.priceOld').val(),
                            priceNow: $('.priceNow').val(),
                            stock: $('.stock').val(),
                            url: $('#upPic').html(),
                            state,
                            classify
                        },
                        success: function(data) {
                            location.href = '../html/goodList.html';
                        }
                    })
                });
                var storage=window.localStorage;
                var uu = document.querySelector('#username');
                if(storage.name){
                    uu.innerHTML=storage.name;
                }else{
                    location.href='http://47.106.178.206:5005/html/longin.html';
                }
                var outbtn = document.querySelector('#output')
                outbtn.onclick = function(){
                    localStorage.removeItem('name');
                }
                var uu = document.querySelector('#username');
                </script>
            </div>
        </div>
        <script>
        //JavaScript代码区域
        layui.use('element', function() {
            var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
            //监听导航点击
            element.on('nav(demo)', function(elem) {
                // console.log(elem);
                layer.msg(elem.text());
            });
        });
        </script>
</body>

</html>